{% load static i18n %}
<!DOCTYPE html>
<html lang="{{ LANGUAGE_CODE }}">
<head>
  <meta charset="UTF-8">
  <title>{% trans "Teacher Test â€“ Result" %}</title>

  <style>
    * { box-sizing:border-box; margin:0; padding:0; font-family:system-ui,-apple-system,BlinkMacSystemFont,"Segoe UI",sans-serif; }
    body { background:#00a9ff; display:flex; justify-content:center; align-items:center; min-height:100vh; }

    .phone{
      width:100%; max-width:420px; height:100vh; margin:0 auto;
      background:linear-gradient(180deg,#020617,#0b1220);
      display:flex; flex-direction:column;
      border-radius:12px; overflow:hidden;
      box-shadow:0 18px 40px rgba(15,23,42,.75);
    }
    .phone__top, .phone__bottom{ height:40px; background:#020617; }

    .screen{
      flex:1; background:#e5edf9; padding:20px;
      width:100%; max-width:428px; margin:0 auto;
      display:flex; flex-direction:column; align-items:center;
      overflow-y:auto;
    }

    .title{
      font-size:26px; font-weight:900;
      margin:10px 0 4px;
      text-align:center; color:#0b1220;
      word-break:break-word;
    }
    .subtitle{
      font-size:14px; font-weight:800;
      color:#475569;
      margin-bottom:14px;
      text-align:center;
    }

    .donut-wrap{
      width:100%;
      display:flex;
      justify-content:center;
      margin:6px 0 14px;
    }
    .donut{
      --p: 0;
      --size: 220px;
      --thickness: 22px;

      --fill: #ef4444;
      --track: #e5e7eb;

      width:var(--size);
      height:var(--size);
      border-radius:50%;
      background:
        conic-gradient(var(--fill) calc(var(--p) * 1%), var(--track) 0);
      display:grid;
      place-items:center;
      position:relative;
      box-shadow:0 12px 26px rgba(15,23,42,.15);
    }
    .donut::before{
      content:"";
      position:absolute;
      inset:var(--thickness);
      background:#ffffff;
      border-radius:50%;
      box-shadow: inset 0 0 0 1px rgba(148,163,184,.35);
    }
    .donut-center{
      position:relative;
      z-index:1;
      font-weight:900;
      font-size:30px;
      color:#0b1220;
    }

    .card{
      width:100%;
      background:#fff;
      border-radius:18px;
      padding:18px;
      box-shadow:0 10px 24px rgba(0,0,0,.10);
      margin-top:8px;
    }
    .row{
      display:flex;
      justify-content:space-between;
      gap:10px;
      padding:8px 0;
      font-weight:900;
      color:#0b1220;
    }
    .muted{ color:#475569; font-weight:800; }

    .btn{
      width:100%;
      margin-top:16px;
      display:block;
      text-decoration:none;
      text-align:center;
      background:#374151;
      color:#fff;
      font-weight:900;
      padding:16px 0;
      border-radius:18px;
      box-shadow:0 10px 24px rgba(0,0,0,.12);
    }
  </style>
</head>

<body>
<div class="phone">
  <div class="phone__top"></div>

  <div class="screen">
    <div class="title">{{ topic_title }}</div>
    <div class="subtitle">{% trans "Teacher test result" %}</div>

    <div class="donut-wrap">
      <div id="donut"
           class="donut"
           data-score="{{ score_percent|default:0 }}">
        <div id="donutText" class="donut-center">0%</div>
      </div>
    </div>

    <div class="card">
      <div class="row"><span class="muted">{% trans "Total questions" %}</span><span>{{ total }}</span></div>
      <div class="row"><span class="muted">{% trans "Answered" %}</span><span>{{ answered }}</span></div>
      <div class="row"><span class="muted">{% trans "Correct" %}</span><span>{{ correct }}</span></div>
      <div class="row"><span class="muted">{% trans "Wrong (incl. unanswered)" %}</span><span>{{ wrong }}</span></div>
    </div>

    <a class="btn" href="{% url 'student_tests' %}">{% trans "Back to tests" %}</a>
  </div>

  <div class="phone__bottom"></div>
</div>

<script>
(function(){
  const donut = document.getElementById('donut');
  const text  = document.getElementById('donutText');
  if (!donut || !text) return;

  let target = parseInt(donut.dataset.score || "0", 10);
  if (!Number.isFinite(target)) target = 0;
  target = Math.max(0, Math.min(100, target));

  const GREEN = "#22c55e";
  const RED   = "#ef4444";
  donut.style.setProperty("--fill", target >= 50 ? GREEN : RED);

  let current = 0;
  const step = Math.max(1, Math.round(target / 40));

  function render(v){
    donut.style.setProperty('--p', v);
    text.textContent = v + "%";
  }

  render(0);

  const t = setInterval(() => {
    current += step;
    if (current >= target){
      current = target;
      render(current);
      clearInterval(t);
      return;
    }
    render(current);
  }, 15);
})();
</script>
</body>
</html>
