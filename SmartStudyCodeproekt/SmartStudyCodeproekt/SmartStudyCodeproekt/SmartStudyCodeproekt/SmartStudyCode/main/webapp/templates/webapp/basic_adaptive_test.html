{% load static i18n %}
<!DOCTYPE html>
<html lang="{{ LANGUAGE_CODE }}">
<head>
  <meta charset="UTF-8">
  <title>{% trans "Adaptive test" %}</title>

  <style>
    .topic-title{
      font-size: 26px;
      font-weight: 900;
      margin: 6px 0 12px;
      text-align:center;
      color:#0b1220;
    }
    .meta-bar{
      width:100%;
      background:#fff;
      border-radius:16px;
      padding:12px 18px;
      display:flex;
      justify-content:space-between;
      align-items:center;
      font-weight:800;
      box-shadow:0 6px 20px rgba(0,0,0,.08);
      margin-bottom:10px;
    }
    .meta-left{ font-size:16px; }
    .meta-right{ font-size:16px; }

    /* ⬇️ остальной CSS у тебя уже есть, НЕ меняю */
    * { box-sizing:border-box; margin:0; padding:0; font-family:system-ui,-apple-system,BlinkMacSystemFont,"Segoe UI",sans-serif; }
    body { background:#00a9ff; display:flex; justify-content:center; align-items:center; min-height:100vh; }
    .phone { width:100%; max-width:420px; height:100vh; margin:0 auto; background:linear-gradient(180deg,#020617,#0b1220); display:flex; flex-direction:column; border-radius:12px; overflow:hidden; box-shadow:0 18px 40px rgba(15,23,42,.75); }
    .phone__top, .phone__bottom { height:40px; background:#020617; }
    .screen { flex:1; background:#e5edf9; padding:20px; width:100%; max-width:428px; margin:0 auto; display:flex; flex-direction:column; align-items:center; overflow-y:auto; }

    .test-header-img{ width:220px; margin:8px auto 10px; display:block; }

    .level-title{
      background:#6ea8ff;
      color:#fff;
      display:inline-block;
      padding:8px 18px;
      border-radius:999px;
      font-weight:600;
      font-size:14px;
      margin-bottom:12px;
    }

    .test-timer{
      width:110px; height:46px; background:#0b1220; border-radius:12px;
      display:flex; align-items:center; justify-content:center;
      margin:8px auto 22px; border:6px solid #ef4444;
      box-shadow:0 10px 24px rgba(0,0,0,.25);
    }
    #timer{ color:#fff; font-weight:800; font-size:18px; letter-spacing:.5px; }

    .question-box{
      background:#fff; border-radius:18px; padding:20px;
      font-size:18px; font-weight:600; margin-bottom:22px;
      box-shadow:0 6px 20px rgba(0,0,0,.08);
      width:100%;
    }
    .answers-grid{ width:100%; display:grid; grid-template-columns:1fr 1fr; gap:14px; }
    .answer-btn{
      background:#2dd4bf; border:none; border-radius:14px;
      padding:16px 12px; font-size:14px; font-weight:600;
      cursor:pointer; transition:.2s;
    }
    .answer-btn:hover{ transform:translateY(-2px); box-shadow:0 6px 14px rgba(0,0,0,.15); }
  </style>
</head>

<body>
<div class="phone">
  <div class="phone__top"></div>

  <div class="screen">

    <div class="topic-title">{{ topic_title }}</div>

    <div class="meta-bar">
      <div class="meta-left">{% trans "Difficulty" %}: {{ difficulty_name }}</div>
      <div class="meta-right">{{ q_index }}/{{ q_total }}</div>
    </div>

    <img src="{% static 'img/python.png' %}" alt="{% trans 'Python' %}" class="test-header-img">

    <div class="level-title">
      {{ difficulty_name }} ({% trans "difficulty" %} {{ difficulty }})
    </div>

    <div class="test-timer">
      <span id="timer"
            data-remaining="{{ remaining_sec|default:0 }}"
            data-finish-url="{{ finish_url }}">
        00:00
      </span>
    </div>

    <div class="question-box">
      {{ question.text }}
    </div>

    <form method="post">
      {% csrf_token %}
      <input type="hidden" name="qid" value="{{ question.id }}">

      <div class="answers-grid">
        {% for ans in answers %}
          <button type="submit"
                  name="choice"
                  value="{% if forloop.counter == 1 %}A{% elif forloop.counter == 2 %}B{% elif forloop.counter == 3 %}C{% else %}D{% endif %}"
                  class="answer-btn">
            {{ ans }}
          </button>
        {% endfor %}
      </div>
    </form>

  </div>

  <div class="phone__bottom"></div>
</div>

<script>
(function () {
  const el = document.getElementById('timer');
  if (!el) return;

  let remaining = parseInt(el.dataset.remaining || "0", 10);
  const finishUrl = el.dataset.finishUrl || "";

  function pad(n){ return String(n).padStart(2, '0'); }
  function render(){
    const m = Math.floor(remaining / 60);
    const s = remaining % 60;
    el.textContent = pad(m) + ":" + pad(s);
  }

  if (!Number.isFinite(remaining) || remaining <= 0) {
    el.textContent = "00:00";
    return;
  }

  render();

  const t = setInterval(() => {
    remaining -= 1;
    if (remaining <= 0){
      clearInterval(t);
      el.textContent = "00:00";
      if (finishUrl) window.location.href = finishUrl;
      return;
    }
    render();
  }, 1000);
})();
</script>
</body>
</html>
